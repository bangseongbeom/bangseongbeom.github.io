{%- if page.comments != false and jekyll.environment == "production" -%}

  {%- assign filename = page.path | split: "/" | last | split: "." | first -%}
  {%- capture captured_keys -%}
  {%- for comment_hash in site.data.comments[filename] -%}
    {{ comment_hash[0] }},
  {%- endfor -%}
  {%- endcapture -%}
  <code>{{ captured_keys | split: "," | sort }}</code>
  {{ assign sorted_keys = captured_keys | split: "," | sort }}
  <h1 id="comments">댓글</h1>
  {%- for key in sorted_keys -%}
    {%- assign comment_hash = site.data.comments[filename][key] -%}
    {%- assign comment = comment_hash[1] -%}
    <article itemprop="comment" itemscope itemtype="http://schema.org/Comment">
      <p>이름: <span itemprop="author">{{ comment.name | xml_escape }}</span></p>
      <p>작성 시간: <time itemprop="dateCreated">{{ comment.date | date: "%F" }}</time></p>
      <p>메시지: <span itemprop="text">{{ comment.message | xml_escape }}</span></p>
    </article>
  {%- else -%}
    <p>댓글이 없습니다.</p>
  {%- endfor -%}
  <h2 id="write-comment">댓글 쓰기</h2>
  <!-- Staticman v3: https://github.com/eduardoboucas/staticman/issues/243#issuecomment-453754860 -->
  <form method="post" action="https://dev.staticman.net/v3/entry/github/{{ site.github.owner_name }}/{{ site.github.repository_name }}/{{ site.github.source.branch }}/comments">
    <p><input name="options[redirect]" type="hidden" value="{{ site.url }}{{ page.url }}#comments"></p>
    <!-- e.g. "2016-01-02-this-is-a-post" -->
    <p><input name="options[filename]" type="hidden" value="{{ filename }}"></p>
    <p><label>이름 (필수 아님): <input name="fields[name]" type="text"></label></p>
    <p><label>이메일 (필수 아님): <input name="fields[email]" type="email"></label></p>
    <p><label>메시지: <textarea name="fields[message]" required></textarea></label></p>
    <p><button type="submit">쓰기</button></p>
  </form>

{%- endif -%}
